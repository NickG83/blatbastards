{{ define "main" }}
<div class="container">
  <div class="row">
    <div class="
      col-lg-8 col-lg-offset-2
      col-md-10 col-md-offset-1
      post-container">

      <h1 class="bb-page-title">Top Roads</h1>

      {{ with .Content }}
        <div class="post-content">
          {{ . }}
        </div>
      {{ end }}

      <div class="rides-list">
        {{ $all := .Pages }}

        {{ $nsw := where $all "Params.state" "NSW" }}
        {{ $vic := where $all "Params.state" "VIC" }}
        {{ $act := where $all "Params.state" "ACT" }}

        {{ if gt (len $nsw) 0 }}
          <h2>NSW</h2>
          <div class="rides-grid">
            {{ $items := slice }}
            {{ range $nsw }}
              {{ $key := lower (replaceRE "(?i)^the\\s+" "" .Title) }}
              {{ $items = $items | append (dict "key" $key "p" .) }}
            {{ end }}

            {{ range sort $items "key" }}
              {{ $p := .p }}
              <article class="ride-item ride-card">
                <h3><a href="{{ $p.RelPermalink }}">{{ $p.Title }}</a></h3>
                <p class="ride-meta">
                  {{ with $p.Params.region }}{{ . }}{{ end }}
                  {{ with $p.Params.surface }} • {{ . }}{{ end }}
                  {{ with $p.Params.distance }} • ~{{ . }} km{{ end }}
                </p>
              </article>
            {{ end }}
          </div>
          <hr>
        {{ end }}

        {{ if gt (len $vic) 0 }}
          <h2>VIC</h2>
          <div class="rides-grid">
            {{ $items := slice }}
            {{ range $vic }}
              {{ $key := lower (replaceRE "(?i)^the\\s+" "" .Title) }}
              {{ $items = $items | append (dict "key" $key "p" .) }}
            {{ end }}

            {{ range sort $items "key" }}
              {{ $p := .p }}
              <article class="ride-item ride-card">
                <h3><a href="{{ $p.RelPermalink }}">{{ $p.Title }}</a></h3>
                <p class="ride-meta">
                  {{ with $p.Params.region }}{{ . }}{{ end }}
                  {{ with $p.Params.surface }} • {{ . }}{{ end }}
                  {{ with $p.Params.distance }} • ~{{ . }} km{{ end }}
                </p>
              </article>
            {{ end }}
          </div>
          <hr>
        {{ end }}

        {{ if gt (len $act) 0 }}
          <h2>ACT</h2>
          <div class="rides-grid">
            {{ $items := slice }}
            {{ range $act }}
              {{ $key := lower (replaceRE "(?i)^the\\s+" "" .Title) }}
              {{ $items = $items | append (dict "key" $key "p" .) }}
            {{ end }}

            {{ range sort $items "key" }}
              {{ $p := .p }}
              <article class="ride-item ride-card">
                <h3><a href="{{ $p.RelPermalink }}">{{ $p.Title }}</a></h3>
                <p class="ride-meta">
                  {{ with $p.Params.region }}{{ . }}{{ end }}
                  {{ with $p.Params.surface }} • {{ . }}{{ end }}
                  {{ with $p.Params.distance }} • ~{{ . }} km{{ end }}
                </p>
              </article>
            {{ end }}
          </div>
          <hr>
        {{ end }}

        {{ if and (eq (len $nsw) 0) (eq (len $vic) 0) (eq (len $act) 0) }}
          <p>No Top Roads published yet. Check back soon.</p>
        {{ end }}
      </div>

    </div>
  </div>
</div>
{{ end }}
