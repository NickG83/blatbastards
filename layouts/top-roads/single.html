{{ define "main" }}
<div class="container">
  <div class="row">
    <div class="
      col-lg-8 col-lg-offset-2
      col-md-10 col-md-offset-1
      post-container">

      <!-- Big page title -->
      <h1 class="bb-page-title">{{ .Title }}</h1>

      <!-- Key road facts -->
      <div class="ride-detail-meta">
        <ul>
          {{ with .Params.intro }}
            <li class="ride-intro">{{ . }}</li>
          {{ end }}
          
          {{ with .Params.state }}
            <li><strong>State:</strong> {{ . }}</li>
          {{ end }}

          {{ with .Params.region }}
            <li><strong>Region:</strong> {{ . }}</li>
          {{ end }}

          {{ with .Params.surface }}
            <li><strong>Surface:</strong> {{ . }}</li>
          {{ end }}

          {{ with .Params.distance }}
            <li><strong>Distance:</strong> ~{{ . }} km</li>
          {{ end }}

          {{ with .Params.start }}
            <li><strong>Start:</strong> {{ . }}</li>
          {{ end }}

          {{ with .Params.finish }}
            <li><strong>Finish:</strong> {{ . }}</li>
          {{ end }}
        </ul>

        {{ with .Params.route_file }}
        <p class="ride-download-btn">
            <a class="btn btn-sm btn-primary ride-download-btn" href="{{ . }}" target="_blank" rel="noopener">
            Download route (GPX)
            </a>
        </p>
        {{ end }}

      </div>

            {{ with .Params.highlights }}
        <div class="ride-detail-content">
        <h4 class="section-title">
        <span class="bb-icon" aria-hidden="true">
            <!-- spark icon -->
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M12 2l1.6 6.2L20 10l-6.4 1.8L12 18l-1.6-6.2L4 10l6.4-1.8L12 2z"/>
            </svg>
        </span>
        Highlights
        </h4>
          <ul>
            {{ range . }}
              {{ $t := printf "%T" . }}
              {{ if eq $t "string" }}
                <li>{{ . }}</li>
              {{ else }}
                <li>{{ .item }}</li>
              {{ end }}
            {{ end }}
          </ul>
        </div>
      {{ end }}

      {{ with .Params.warnings }}
        <div class="ride-detail-content">
        <h4 class="section-title">
        <span class="bb-icon" aria-hidden="true">
            <!-- warning triangle -->
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-8h-2v6h2V8z"/>
            </svg>
        </span>
        Warnings
        </h4>
          <ul>
            {{ range . }}
              {{ $t := printf "%T" . }}
              {{ if eq $t "string" }}
                <li>{{ . }}</li>
              {{ else }}
                <li>{{ .item }}</li>
              {{ end }}
            {{ end }}
          </ul>
        </div>
      {{ end }}

        <div class="ride-detail-content">
        {{ if .Content }}
            {{ .Content }}
        {{ else }}
            {{ with .Params.body }}
            {{ . | markdownify }}
            {{ end }}
        {{ end }}
        </div>

      <!-- Optional hero image -->
      {{ with .Params.hero_image }}
        <p>
          <img class="img-responsive" src="{{ . }}" alt="{{ $.Title }}">
        </p>
      {{ end }}

      {{ with .Params.map_embed }}
        <div class="ride-map-embed">
            <h3>Route</h3>
            <iframe
            src="{{ . }}"
            width="640"
            height="480"
            style="border:0;"
            loading="lazy"
            allowfullscreen>
            </iframe>
         </div>
      {{ end }}

      <!-- Gallery (same logic as rides: supports old string format + new object format) -->
      {{ with .Params.gallery }}
        <div class="ride-detail-gallery">
          {{ range . }}
            {{ $t := printf "%T" . }}
            {{ if eq $t "string" }}
              <figure class="ride-gallery-item">
                <img class="ride-gallery-img" src="{{ . | relURL }}" alt="{{ $.Title }}">
              </figure>
            {{ else }}
              <figure class="ride-gallery-item">
                <img class="ride-gallery-img" src="{{ .image | relURL }}" alt="{{ .caption | default $.Title }}">
                {{ with .caption }}
                  <figcaption class="ride-gallery-caption">{{ . }}</figcaption>
                {{ end }}
              </figure>
            {{ end }}
          {{ end }}
        </div>
      {{ end }}

    </div>
  </div>
</div>
{{ end }}
